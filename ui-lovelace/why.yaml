title: Why
path: debugging
badges: []
cards:
  - type: custom:auto-entities
    card:
      type: entities
      title: Lights On 
    filter:
      include:
        - entity_id: switch.*_light*
          state: 'on'
          options:
            type: custom:template-entity-row
            secondary: '{{ states("input_text." + config.entity[7:] + "_why_on") }}'
            toggle: true
        - entity_id: switch.*_lamp*
          state: 'on'
          options:
            type: custom:template-entity-row
            secondary: '{{ states("input_text." + config.entity[7:] + "_why_on") }}'
            toggle: true
        - entity_id: light.*
          state: 'on'
          options:
            type: custom:template-entity-row
            secondary: '{{ states("input_text." + config.entity[6:] + "_why_on") }}'
            toggle: true
        - entity_id: timer.*_off
          state: 'active'
          options:
            type: custom:timer-bar-card
        - entity_id: timer.*_off
          state: 'paused'
          options:
            type: custom:timer-bar-card
      exclude: []
    sort:
      method: name
  - type: custom:auto-entities
    card:
      type: entities
      title: Lights Off 
    filter:
      include:
        - entity_id: switch.*_light*
          state: 'off'
          options:
            type: custom:template-entity-row
            secondary: '{{ states("input_text." + config.entity[7:] + "_why_off") }}'
            toggle: true
        - entity_id: switch.*_lamp*
          state: 'off'
          options:
            type: custom:template-entity-row
            secondary: '{{ states("input_text." + config.entity[7:] + "_why_off") }}'
            toggle: true
        - entity_id: light.*
          state: 'off'
          options:
            type: custom:template-entity-row
            secondary: '{{ states("input_text." + config.entity[6:] + "_why_off") }}'
            toggle: true
        - entity_id: timer.*_on
          state: 'active'
          options:
            type: custom:timer-bar-card
        - entity_id: timer.*_on
          state: 'paused'
          options:
            type: custom:timer-bar-card

      exclude: []
    sort:
      method: name
  - type: custom:auto-entities
    card:
      type: entities
      title: Recent Automations
      show_header_toggle: false
    filter:
      include:
        - domain: script
          not:
            attributes:
              current: 0
          options:
            type: custom:template-entity-row
            active: true
            secondary: '{{ relative_time(state_attr(config.entity, ''last_triggered'')) }} ago'
            state: '{{ state_attr(config.entity, ''current'') }} Running'
            hold_action: |
              {
                "action": "navigate",
                "navigation_path": "/config/script/trace/{{ state_attr(config.entity, 'id') }}"
              }
        - domain: script
          last_triggered: < 5
          options:
            type: custom:template-entity-row
            active: '{{ (state_attr(config.entity, ''current'') | int) > 0 }}'
            secondary: |
              {%- if state_attr(config.entity, 'last_triggered') -%}
                {{ relative_time(state_attr(config.entity, 'last_triggered')) }} ago
              {%- else -%}
                Never triggered
              {%- endif -%}
            state: Not Running
            hold_action: |
              {
                "action": "navigate",
                "navigation_path": "/config/automation/script/{{ state_attr(config.entity, 'id') }}"
              }
        - domain: automation
          not:
            attributes:
              current: 0
          options:
            type: custom:template-entity-row
            active: true
            secondary: '{{ relative_time(state_attr(config.entity, ''last_triggered'')) }} ago'
            state: '{{ state_attr(config.entity, ''current'') }} Running'
            hold_action: |
              {
                "action": "navigate",
                "navigation_path": "/config/automation/trace/{{ state_attr(config.entity, 'id') }}"
              }
        - domain: automation
          last_triggered: < 5
          options:
            type: custom:template-entity-row
            active: '{{ (state_attr(config.entity, ''current'') | int) > 0 }}'
            secondary: |
              {%- if state_attr(config.entity, 'last_triggered') -%}
                {{ relative_time(state_attr(config.entity, 'last_triggered')) }} ago
              {%- else -%}
                Never triggered
              {%- endif -%}
            state: Not Running
            hold_action: |
              {
                "action": "navigate",
                "navigation_path": "/config/automation/trace/{{ state_attr(config.entity, 'id') }}"
              }
    show_empty: false
    unique: entity
    sort:
      method: last_triggered
      reverse: true