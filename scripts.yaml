learn_remote:
  sequence:
  - service: remote.learn_command
    target:
      entity_id: remote.downstairs_tv_remote
    data:
      device: Xfinity
      command:
      - Replay
  mode: single
  alias: Learn remote
turn_off_lights_on_restart:
  sequence:
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.outside_garage_door
        state: 'off'
      sequence:
      - type: turn_off
        device_id: 2883dfd4ee7d32b6069bc33aa9d8f6b5
        entity_id: switch.dog_run_light
        domain: switch
    default: []
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.front_entry_motion
        state: 'off'
      sequence:
      - type: turn_off
        device_id: 4e01fd4c9483873139846b8172548fb9
        entity_id: switch.front_stairs_lights
        domain: switch
    default: []
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.hallway_motion
        state: 'off'
      sequence:
      - type: turn_off
        device_id: 01234a8756742395a61c02fe8328d31c
        entity_id: switch.back_stairs_lights
        domain: switch
    default: []
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.master_bathroom_motion
        state: 'off'
        for: 00:05:00
      sequence:
      - type: turn_off
        device_id: 8c22ac95adf287b795831ca2d91a0ffa
        entity_id: switch.bathroom_bath_light
        domain: switch
      - type: turn_off
        device_id: 8c22ac95adf287b795831ca2d91a0ffa
        entity_id: switch.bathroom_vanity_lights
        domain: switch
      - type: turn_off
        device_id: 6aa62bb4294ac780d9e6ef46f8c339cb
        entity_id: switch.shower_light
        domain: switch
    default: []
  - choose:
    - conditions:
      - condition: state
        entity_id: cover.garage_door
        state: open
        for: 00:05:00
      sequence:
      - service: notify.mobile_app_matts_iphone
        data:
          message: 'Warning: The garage door is open'
    default: []
  - choose:
    - conditions:
      - condition: numeric_state
        entity_id: sensor.master_bathroom_humidity
        below: '60'
      sequence:
      - type: turn_off
        device_id: 6aa62bb4294ac780d9e6ef46f8c339cb
        entity_id: switch.shower_fan
        domain: switch
    default: []
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.inside_garage_door
        state: 'off'
        for: 00:10:00
      sequence:
      - type: turn_off
        device_id: 5492be1f2756861ce86ce4fdb69479ef
        entity_id: switch.garage_lights
        domain: switch
    default: []
  mode: single
  alias: Reset system on restart (old)
xfinity_left:
  alias: Rachel Maddow Show
  sequence:
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command: Exit
  - delay:
      hours: 0
      minutes: 0
      seconds: 3
      milliseconds: 0
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HPAcZBxkHGQc4BxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdBxkHPAcZBxkHOAcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HUwcZBxkHGQciBxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdBy8HPAcZBxkHIgcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HUwcZBxkHGQciBxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdBy8HPAcZBxkHIgcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HSgcZBxkHGQcrBxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdByYHPAcZBxkHKwcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHEBx0HTwcZBxkHGQcmBxkHGQcACk4HHQc4BxkHXAcrBysHJgdXBwABxAcdBysHPAcZBxkHJgcZBxkHAApOAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HRgcZBxkHGQcvBxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdByIHPAcZBxkHLwcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHEBx0HXAcZBxkHGQcZBxkHGQcACk4HHQc4BxkHXAcrBysHJgdXBwABxAcdBzgHPAcZBxkHGQcZBxkHAApOAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HQQcZBxkHGQc0BxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdBx0HPAcZBxkHNAcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HUwcZBxkHGQciBxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdBy8HPAcZBxkHIgcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHEBx0HTwcZBxkHGQcmBxkHGQcACk4HHQc4BxkHXAcrBysHJgdXBwABxAcdBysHPAcZBxkHJgcZBxkHAApOAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHEBx0HTwcZBxkHGQcmBxkHGQcACk4HHQc4BxkHXAcrBysHJgdXBwABxAcdBysHPAcZBxkHJgcZBxkHAApOAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HQQcZBxkHGQc0BxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdBx0HPAcZBxkHNAcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HNAcZBxkHGQdBBxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdB1cHPAcZBxkHQQcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command:
      - b64:JgBQAAcdBzgHGQdcBysHKwcmB1cHAAHFBx0HSgcZBxkHIgciBxkHGQcAClEHHQc4BxkHXAcrBysHJgdXBwABxQcdByYHPAcZByIHIgcZBxkHAApRAAAAAAAAAAA=
  - delay: 3
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Xfinity
      command: b64:JgDEAAYdBjkIFwZdCCoFLAglBlkIAAHDCBwJOwYZBhoEJQYwBhoFGgYACk0IHAY5CRcGXQgpCSkFKAZYCQABwwgcBhoGPQYaBSQFMQYaBQAKbgccCDcGGgZdCCkGKwYoBVkGAAHFBh8GGgU+BhkJIAYxBhkGAApsCRwGOQYaBV0GLAYrBicGWQgAAcMIHQgXBj4IFwYjBjEFGgYaBAALTAgcBjoFGgZdCCkGLAYnBlgJAAHDBh4GIwYaBRoFWgZdCBcGGgUADQU=
  mode: single
downstairs_tv_power_on:
  alias: Downstairs TV Power On
  sequence:
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Yamaha
      command: PowerOn
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: PioneerTV
      command: Power
  mode: single
downstairs_tv_power_off:
  alias: Downstairs TV Power Off
  sequence:
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: PioneerTV
      command: Power
  - service: remote.send_command
    target:
      device_id: e25a5843dcd6df5832a249f48c90e1f9
    data:
      device: Yamaha
      command: PowerOff
  mode: single
turn_off_all_lights:
  sequence:
  - service: homeassistant.turn_off
    target:
      entity_id: group.downstairs
  - service: timer.cancel
    target:
      entity_id: "{% set var = namespace(timer=\"\") %} {% for entity in state_attr('group.downstairs','entity_id')\
        \ %}\n  {% set parts = entity.split('.') %}\n  {% set var.timer = var.timer\
        \ + \"timer.\" + parts[1] + \"_off\" %}\n  {% if not loop.last %}\n    {%\
        \ set var.timer = var.timer + \", \" %}\n  {% endif %}\n{% endfor %} {{ var.timer\
        \ }}\n"
  mode: single
  alias: Turn off all downstairs lights
  icon: mdi:lightbulb
turn_off_all_upstairs_lights_except_kids:
  alias: Turn off all upstairs lights (except kids)
  sequence:
  - choose:
    - conditions:
      - condition: state
        entity_id: input_boolean.guestroom_in_use
        state: 'off'
      sequence:
      - type: turn_off
        device_id: c32cc10983532262a768e043288f286f
        entity_id: switch.guest_bedroom_lights
        domain: switch
      - service: timer.cancel
        target:
          entity_id: timer.guest_bedroom_lights_off
    default: []
  - service: homeassistant.turn_off
    target:
      entity_id: group.upstairs_master_and_halls
  - service: timer.cancel
    target:
      entity_id: "{% set var = namespace(timer=\"\") %} {% for entity in state_attr('group.upstairs_master_and_halls','entity_id')\
        \ %}\n  {% set parts = entity.split('.') %}\n  {% set var.timer = var.timer\
        \ + \"timer.\" + parts[1] + \"_off\" %}\n  {% if not loop.last %}\n    {%\
        \ set var.timer = var.timer + \", \" %}\n  {% endif %}\n{% endfor %} {{ var.timer\
        \ }}\n"
  mode: single
  icon: mdi:lightbulb
turn_off_kids_lights:
  alias: Turn off all kids lights
  sequence:
  - service: homeassistant.turn_off
    target:
      entity_id: group.upstairs_kids
  - service: timer.cancel
    target:
      entity_id: "{% set var = namespace(timer=\"\") %} {% for entity in state_attr('group.upstairs_kids','entity_id')\
        \ %}\n  {% set parts = entity.split('.') %}\n  {% set var.timer = var.timer\
        \ + \"timer.\" + parts[1] + \"_off\" %}\n  {% if not loop.last %}\n    {%\
        \ set var.timer = var.timer + \", \" %}\n  {% endif %}\n{% endfor %} {{ var.timer\
        \ }}\n"
  mode: single
  icon: mdi:lightbulb
find_matts_phone:
  alias: Find Matt’s Phone
  sequence:
  - service: notify.mobile_app_matts_iphone
    data:
      message: Home Assistant is searching for Matt’s phone
      data:
        push:
          interruption-level: time-sensitive
  mode: single
  icon: hass:phone
reset_system_on_restart:
  alias: Reset system on restart
  sequence:
  - service: timer.start
    data:
      duration: 00:15:00
    target:
      entity_id: "{% set entities = namespace(string=\"timer.null_timer\") %} {% for\
        \ entity_id in states.group.entities_15min.attributes.entity_id if states(entity_id)\
        \ == 'on'%}\n  {% set parts = entity_id.split('.') %}\n  {% if loop.first\
        \ %}\n    {% set entities.string = \"timer.\" + parts[1] + \"_off\" %}\n \
        \ {% else %}\n    {% set entities.string = entities.string + \", timer.\"\
        \ + parts[1] + \"_off\" %}\n  {% endif %}\n{% endfor %} {{ entities.string\
        \ }}\n"
  - service: timer.start
    data:
      duration: 00:30:00
    target:
      entity_id: "{% set entities = namespace(string=\"timer.null_timer\") %} {% for\
        \ entity_id in states.group.entities_30min.attributes.entity_id if states(entity_id)\
        \ == 'on'%}\n  {% set parts = entity_id.split('.') %}\n  {% if loop.first\
        \ %}\n    {% set entities.string = \"timer.\" + parts[1] + \"_off\" %}\n \
        \ {% else %}\n    {% set entities.string = entities.string + \", timer.\"\
        \ + parts[1] + \"_off\" %}\n  {% endif %}\n{% endfor %} {{ entities.string\
        \ }}\n"
  - service: timer.start
    data:
      duration: 01:00:00
    target:
      entity_id: "{% set entities = namespace(string=\"timer.null_timer\") %} {% for\
        \ entity_id in states.group.entities_60min.attributes.entity_id if states(entity_id)\
        \ == 'on'%}\n  {% set parts = entity_id.split('.') %}\n  {% if loop.first\
        \ %}\n    {% set entities.string = \"timer.\" + parts[1] + \"_off\" %}\n \
        \ {% else %}\n    {% set entities.string = entities.string + \", timer.\"\
        \ + parts[1] + \"_off\" %}\n  {% endif %}\n{% endfor %} {{ entities.string\
        \ }}\n"
  - service: timer.start
    data:
      duration: 02:00:00
    target:
      entity_id: "{% set entities = namespace(string=\"timer.null_timer\") %} {% for\
        \ entity_id in states.group.entities_120min.attributes.entity_id if states(entity_id)\
        \ == 'on'%}\n  {% set parts = entity_id.split('.') %}\n  {% if loop.first\
        \ %}\n    {% set entities.string = \"timer.\" + parts[1] + \"_off\" %}\n \
        \ {% else %}\n    {% set entities.string = entities.string + \", timer.\"\
        \ + parts[1] + \"_off\" %}\n  {% endif %}\n{% endfor %} {{ entities.string\
        \ }}\n"
  - choose:
    - conditions:
      - condition: state
        entity_id: binary_sensor.office_motion_occupancy
        state: 'on'
      sequence:
      - service: timer.pause
        target:
          entity_id: timer.office_light_off
    default: []
  - choose:
    - conditions:
      - condition: state
        entity_id: cover.garage_door
        state: open
        for: 00:00:00
      sequence:
      - service: notify.mobile_app_matts_iphone
        data:
          message: 'Warning: The garage door is open'
    default: []
  - service: timer.start
    data:
      duration: 00:01:30
    target:
      entity_id: timer.rtl_timer
  mode: single
